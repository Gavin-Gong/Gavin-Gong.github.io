<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>装饰器 | Whisper of Zen</title>
    <meta name="description" content=" ">
    
    
    <link rel="preload" href="/assets/css/0.styles.fba42894.css" as="style"><link rel="preload" href="/assets/js/app.59d00a75.js" as="script"><link rel="preload" href="/assets/js/34.ddc3b1f1.js" as="script"><link rel="prefetch" href="/assets/js/17.6386f146.js"><link rel="prefetch" href="/assets/js/1.ffe9e485.js"><link rel="prefetch" href="/assets/js/2.cf650ab0.js"><link rel="prefetch" href="/assets/js/3.e3fb4da0.js"><link rel="prefetch" href="/assets/js/4.de837abb.js"><link rel="prefetch" href="/assets/js/5.446420c6.js"><link rel="prefetch" href="/assets/js/6.4f725ad5.js"><link rel="prefetch" href="/assets/js/7.17c82b6f.js"><link rel="prefetch" href="/assets/js/8.f8936119.js"><link rel="prefetch" href="/assets/js/9.0c74e890.js"><link rel="prefetch" href="/assets/js/10.ef42152b.js"><link rel="prefetch" href="/assets/js/11.e87f2651.js"><link rel="prefetch" href="/assets/js/12.071a2e10.js"><link rel="prefetch" href="/assets/js/13.e7b799c4.js"><link rel="prefetch" href="/assets/js/14.acb4d5e5.js"><link rel="prefetch" href="/assets/js/15.036193c8.js"><link rel="prefetch" href="/assets/js/16.3bda7c3f.js"><link rel="prefetch" href="/assets/js/18.3ee73003.js"><link rel="prefetch" href="/assets/js/19.120461a7.js"><link rel="prefetch" href="/assets/js/20.118f45d5.js"><link rel="prefetch" href="/assets/js/21.63cbba31.js"><link rel="prefetch" href="/assets/js/22.164cb7c0.js"><link rel="prefetch" href="/assets/js/23.2f1c5f70.js"><link rel="prefetch" href="/assets/js/24.d9375577.js"><link rel="prefetch" href="/assets/js/25.f88a1869.js"><link rel="prefetch" href="/assets/js/26.7770e82d.js"><link rel="prefetch" href="/assets/js/27.8f8306f3.js"><link rel="prefetch" href="/assets/js/28.dac917c9.js"><link rel="prefetch" href="/assets/js/29.c389de58.js"><link rel="prefetch" href="/assets/js/30.74fe5357.js"><link rel="prefetch" href="/assets/js/31.23ed29b3.js"><link rel="prefetch" href="/assets/js/32.048d0cd1.js"><link rel="prefetch" href="/assets/js/33.6d20c0ac.js"><link rel="prefetch" href="/assets/js/35.b9e16471.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fba42894.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Whisper of Zen
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active">主页</a></div><div class="nav-item"><a href="/Go/" class="nav-link">Go</a></div><div class="nav-item"><a href="https://github.com/Gavin-Gong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active">主页</a></div><div class="nav-item"><a href="/Go/" class="nav-link">Go</a></div><div class="nav-item"><a href="https://github.com/Gavin-Gong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><!----></div><div class="page"><div class="content"><h1 id="装饰器"><a href="#装饰器" aria-hidden="true" class="header-anchor">#</a> 装饰器</h1><h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2><p>一直觉得装饰器的写法有种蜜汁好感和好奇，例如 <code>@component</code>或者<code>@connect(x, y)</code>。</p><p>装饰器在 React 和 Angular 中很常见，因为这两个框架很强调类，而装饰器的作用范围正是类和类成员，来看装饰器提案的一句话</p><blockquote><p>Decorators make it possible to annotate and modify classes and properties at design time.</p></blockquote><p>指出了装饰器作用对象，注意到最后三个单词 <code>at design time</code>, 再抄袭一句话</p><blockquote><p>装饰器对类的行为的改变，是代码编译时发生的，而不是在运行时。这意味着，装饰器能在编译阶段运行代码。也就是说，装饰器本质就是编译时执行的函数</p></blockquote><p>装饰器对类的修改是一次性的，而且是在代码编译阶段完成装饰
看一个类装饰器</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> decorator <span class="token operator">=</span> （target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;gggg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  target<span class="token punctuation">.</span>useDecorator <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

@decorator <span class="token comment">// 装饰的时候立即输出 gggg， 在实例化Test得时候不会再输出了</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>以上包含了装饰器的基本使用，所谓装饰器本质上就是一个通过<code>@</code>调用的特殊函数, 这个函数包括三个参数 target(类), name(key), descriptor(属性描述), 在作为<em>类装饰器</em>使用时没有 name 和 descriptor， 另外 descriptor 包含以下属性</p><div class="language-js extra-class"><pre class="language-js"><code>descriptor<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   value<span class="token punctuation">:</span> <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token comment">// 其实就是要装饰的成员</span>
   writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
   configurable<span class="token punctuation">:</span> <span class="token boolean">true</span>
 <span class="token punctuation">}</span>
</code></pre></div><h2 id="babel-环境配置"><a href="#babel-环境配置" aria-hidden="true" class="header-anchor">#</a> babel 环境配置</h2><p>除了 env 之外 还需要安装以下依赖</p><blockquote><p>yarn add -D babel-plugin-transform-decorators-legacy</p></blockquote><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-decorators-legacy&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="类装饰器"><a href="#类装饰器" aria-hidden="true" class="header-anchor">#</a> 类装饰器</h2><p>对一个类进行装饰， 可以修改类的原型链</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 添加类的装静态性</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">decorator</span> <span class="token operator">=</span> target <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>useDecorator <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 使用方法</span>
@decorator
<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改原型链 -》 对类的每个实例都器作用</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">decorator</span> <span class="token operator">=</span> target <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>useDecorator <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="类成员装饰器"><a href="#类成员装饰器" aria-hidden="true" class="header-anchor">#</a> 类成员装饰器</h2><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 标记某个类成员为只读</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">readonly</span> <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> descriptor<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
  @readonly
  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对类方法进行装饰， 自定义参数 输出日志信息</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> text <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldFn <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    descriptor<span class="token punctuation">.</span><span class="token function-variable function">value</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">oldFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> descriptor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
  @<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;gg&quot;</span><span class="token punctuation">)</span>
  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tl-dr"><a href="#tl-dr" aria-hidden="true" class="header-anchor">#</a> TL; DR</h2><p>总的来说</p><ul><li>装饰器的是一个能够被<code>@</code>调用的特殊<em>包装</em>函数，</li><li>装饰器只作用于<em>类</em>和<em>类成员</em></li><li>装饰器函数能拿到对应的类或者对应的属性以及它的值和 descriptor 进行修改， 达到装饰的目的</li><li>装饰器对类成员的改变只在代码编译时发生</li></ul><h2 id="引用链接"><a href="#引用链接" aria-hidden="true" class="header-anchor">#</a> 引用链接</h2><p><a href="https://github.com/wycats/javascript-decorators" target="_blank" rel="noopener noreferrer">装饰器提案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="http://es6.ruanyifeng.com/#docs/decorator" target="_blank" rel="noopener noreferrer">ES6 入门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><div class="page-edit"><!----><div class="last-updated"><span class="prefix">Last Updated: </span><span class="time">7/9/2018, 2:59:44 PM</span></div></div><!----></div></div></div>
    <script src="/assets/js/34.ddc3b1f1.js" defer></script><script src="/assets/js/app.59d00a75.js" defer></script>
  </body>
</html>
